# Spark Default Configuration for QuickChat ETL

# Application settings
spark.app.name                          QuickChat-ETL
spark.master                            spark://spark-master:7077

# Delta Lake
spark.sql.extensions                    io.delta.sql.DeltaSparkSessionExtension
spark.sql.catalog.spark_catalog         org.apache.spark.sql.delta.catalog.DeltaCatalog
spark.databricks.delta.retentionDurationCheck.enabled   false

# Memory settings
spark.driver.memory                     2g
spark.executor.memory                   2g
spark.executor.cores                    2

# Shuffle settings
spark.sql.shuffle.partitions            200
spark.default.parallelism               100

# Adaptive Query Execution
spark.sql.adaptive.enabled              true
spark.sql.adaptive.coalescePartitions.enabled   true
spark.sql.adaptive.skewJoin.enabled     true

# Serialization
spark.serializer                        org.apache.spark.serializer.KryoSerializer
spark.kryoserializer.buffer.max         512m

# Event logging for History Server
spark.eventLog.enabled                  true
spark.eventLog.dir                      /opt/spark/logs
spark.history.fs.logDirectory           /opt/spark/logs

# S3/MinIO Configuration
spark.hadoop.fs.s3a.impl                org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.endpoint            http://minio:9000
spark.hadoop.fs.s3a.access.key          minioadmin
spark.hadoop.fs.s3a.secret.key          minioadmin123
spark.hadoop.fs.s3a.path.style.access   true
spark.hadoop.fs.s3a.connection.ssl.enabled   false

# MongoDB Configuration
spark.mongodb.read.connection.uri       mongodb://mongodb:27017
spark.mongodb.write.connection.uri      mongodb://mongodb:27017
spark.mongodb.read.database             quickchat
spark.mongodb.write.database            quickchat

# Kafka Configuration
spark.kafka.bootstrap.servers           kafka:9092

# SQL settings
spark.sql.parquet.compression.codec     snappy
spark.sql.sources.partitionOverwriteMode    dynamic

# UI
spark.ui.port                           4040
spark.ui.enabled                        true

# Dynamic Allocation (optional)
spark.dynamicAllocation.enabled         false
spark.dynamicAllocation.minExecutors    1
spark.dynamicAllocation.maxExecutors    4
