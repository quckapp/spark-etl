quickchat {
  app {
    name = "QuickChat Spark ETL"
    environment = "development"
    environment = ${?APP_ENV}
  }

  spark {
    master = "local[*]"
    master = ${?SPARK_MASTER}

    app-name = "QuickChat-ETL"

    config {
      "spark.sql.extensions" = "io.delta.sql.DeltaSparkSessionExtension"
      "spark.sql.catalog.spark_catalog" = "org.apache.spark.sql.delta.catalog.DeltaCatalog"
      "spark.databricks.delta.retentionDurationCheck.enabled" = "false"
      "spark.sql.shuffle.partitions" = "200"
      "spark.default.parallelism" = "100"
      "spark.sql.adaptive.enabled" = "true"
      "spark.sql.adaptive.coalescePartitions.enabled" = "true"
      "spark.serializer" = "org.apache.spark.serializer.KryoSerializer"
    }
  }

  # Data Lake paths (S3 or local)
  data-lake {
    base-path = "s3a://quickchat-data-lake"
    base-path = ${?DATA_LAKE_PATH}

    bronze {
      path = ${quickchat.data-lake.base-path}"/bronze"
      messages = ${quickchat.data-lake.bronze.path}"/messages"
      users = ${quickchat.data-lake.bronze.path}"/users"
      conversations = ${quickchat.data-lake.bronze.path}"/conversations"
      calls = ${quickchat.data-lake.bronze.path}"/calls"
      events = ${quickchat.data-lake.bronze.path}"/events"
      notifications = ${quickchat.data-lake.bronze.path}"/notifications"
      media = ${quickchat.data-lake.bronze.path}"/media"
    }

    silver {
      path = ${quickchat.data-lake.base-path}"/silver"
      messages = ${quickchat.data-lake.silver.path}"/messages"
      users = ${quickchat.data-lake.silver.path}"/users"
      conversations = ${quickchat.data-lake.silver.path}"/conversations"
      calls = ${quickchat.data-lake.silver.path}"/calls"
      sessions = ${quickchat.data-lake.silver.path}"/sessions"
      user-activity = ${quickchat.data-lake.silver.path}"/user_activity"
    }

    gold {
      path = ${quickchat.data-lake.base-path}"/gold"
      analytics = ${quickchat.data-lake.gold.path}"/analytics"
      metrics = ${quickchat.data-lake.gold.path}"/metrics"
      reports = ${quickchat.data-lake.gold.path}"/reports"
      ml-features = ${quickchat.data-lake.gold.path}"/ml_features"
      aggregations = ${quickchat.data-lake.gold.path}"/aggregations"
    }

    checkpoints = ${quickchat.data-lake.base-path}"/checkpoints"
  }

  # MongoDB configuration
  mongodb {
    uri = "mongodb://localhost:27017"
    uri = ${?MONGODB_URI}
    database = "quickchat"
    database = ${?MONGODB_DATABASE}

    collections {
      messages = "messages"
      users = "users"
      conversations = "conversations"
      calls = "calls"
      notifications = "notifications"
    }

    read-config {
      partitioner = "MongoShardedPartitioner"
      partitioner-options {
        partition-key = "_id"
        partition-size-mb = 64
      }
    }
  }

  # MySQL configuration
  mysql {
    url = "jdbc:mysql://localhost:3306/quickchat_users"
    url = ${?MYSQL_URL}
    user = "root"
    user = ${?MYSQL_USER}
    password = "password"
    password = ${?MYSQL_PASSWORD}
    driver = "com.mysql.cj.jdbc.Driver"

    tables {
      users = "users"
      auth = "auth_tokens"
      sessions = "sessions"
      audit-logs = "audit_logs"
    }
  }

  # Kafka configuration
  kafka {
    bootstrap-servers = "localhost:9092"
    bootstrap-servers = ${?KAFKA_BOOTSTRAP_SERVERS}

    topics {
      messages = "quickchat.messages"
      users = "quickchat.users"
      calls = "quickchat.calls"
      events = "quickchat.events"
      notifications = "quickchat.notifications"
      analytics = "quickchat.analytics"
    }

    consumer {
      group-id = "quickchat-etl"
      auto-offset-reset = "earliest"
      enable-auto-commit = "false"
    }

    streaming {
      trigger-interval = "10 seconds"
      checkpoint-location = ${quickchat.data-lake.checkpoints}"/kafka"
    }
  }

  # AWS S3 configuration
  aws {
    access-key = ""
    access-key = ${?AWS_ACCESS_KEY_ID}
    secret-key = ""
    secret-key = ${?AWS_SECRET_ACCESS_KEY}
    region = "us-east-1"
    region = ${?AWS_REGION}

    s3 {
      endpoint = ""
      endpoint = ${?S3_ENDPOINT}
      path-style-access = true
    }
  }

  # ETL Job configurations
  etl {
    batch-size = 10000
    partition-columns = ["year", "month", "day"]

    bronze {
      # Extract raw data retention (days)
      retention-days = 90
      # Incremental load lookback (hours)
      lookback-hours = 24
    }

    silver {
      # Cleaned data retention
      retention-days = 365
      # Deduplication window
      dedup-window-hours = 48
    }

    gold {
      # Aggregated data retention
      retention-days = 730
      # Metrics calculation window
      metrics-window-days = 30
    }

    streaming {
      # Micro-batch interval
      trigger-interval = "1 minute"
      # Watermark delay for late data
      watermark-delay = "10 minutes"
    }
  }

  # ClickHouse for analytics (optional)
  clickhouse {
    host = "localhost"
    host = ${?CLICKHOUSE_HOST}
    port = 8123
    port = ${?CLICKHOUSE_PORT}
    database = "quickchat_analytics"
    user = "default"
    password = ""
  }
}
